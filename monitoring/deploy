#!/bin/bash

set -env

echo "=== Deploying Monitoring Stack ==="

# Make sure prometheus config exists
if [ ! -f ./prometheus/prometheus.yml ]; then
  echo "Missing prometheus.yml file"
  exit 1
fi

cd /home/ec2-user/monitoring

echo "Pulling latest images..."
docker-compose -f docker-compose.monitoring.yml pull

echo "Stopping any running services..."
docker-compose -f docker-compose.monitoring.yml down

echo "Starting monitoring stack..."
docker-compose -f docker-compose.monitoring.yml up -d

echo "Pruning old images..."
docker image prune -f

echo "=== Monitoring deployment complete ==="
